#!/bin/sh

echo "==============================================="
if [ -z ${TOKEN_OWNER+x} ]
  then
    echo "It looks like you need to add the TOKEN_OWNER var"
    echo "to your ~/.bashrc. Please type the github username"
    echo "of the teacher. Remember, this user will need to have"
    echo "full admin access to the teaching organization."
    read newname
    echo "export TOKEN_OWNER='$newname'" >> ~/.bashrc
  else
    echo "TOKEN_OWNER = $TOKEN_OWNER."
fi
echo "==============================================="
if [ -z ${GITHUBTEACHER_TOKEN+x} ]
  then
    echo "It looks like you need to add the"
    echo "GITHUBTEACHER_TOKEN var to your ~/.bashrc."
    echo "Please generate an OAUTH token on the"
    echo "teacher account and paste it here."
    read newtoken
    echo "export GITHUBTEACHER_TOKEN='$newtoken'" >> ~/.bashrc
  else
    echo "GITHUBTEACHER_TOKEN is set!"
fi
echo "==============================================="
if [ -z ${INSTANCE_URL+x} ]
  then
    echo "It looks like you need to add the"
    echo "INSTANCE_URL var to your ~/.bashrc. Please type the"
    echo "root endpoint for your github instance."
    echo "For example: api.github.com OR mycompany.github.com/api/v3"
    read newurl
    echo "export INSTANCE_URL='$newurl'" >> ~/.bashrc
    if echo "$newurl" | grep -iq "\<api.github.com\>" ;
      then
        echo "export ROOT_URL='github.com'" >> ~/.bashrc
      else
        #strip the API part
        strippedURL=$(echo "$newurl" | sed -E 's/\/api\/v3//')
        echo "export ROOT_URL='$strippedURL'" >> ~/.bashrc
    fi
  else
    echo "INSTANCE_URL = $INSTANCE_URL"
    echo "ROOT_URL = $ROOT_URL"
fi
echo "==============================================="
if [ -z ${CLASS_ORG+x} ]
  then
    echo "It looks like you need to add the CLASS_ORG var"
    echo "to your ~/.bashrc. Please type the organization name"
    echo "used for github training on your instance."
    echo "For example: githubschool"
    read neworg
    echo "export CLASS_ORG='$neworg'" >> ~/.bashrc
  else
    echo "CLASS_ORG = $CLASS_ORG"
fi
echo "==============================================="
if [ -z ${SURVEY_TOKEN+x} ]
  then
    echo "The scripts use the SurveyGizmo API to auto-generate"
    echo "the post-class survey. You will need to add the api"
    echo "token generated by SurveyGizmo to your ~/.bashrc."
    echo "Please paste it below:"
    read surveytoken
    echo "export SURVEY_TOKEN='$surveytoken'" >> ~/.bashrc
  else
    echo "SURVEY_TOKEN is set!"
fi
echo "==============================================="
if [ -z ${SURVEY_SECRET+x} ]
  then
    echo "The SurveyGizmo API also requires a secret."
    echo "You will need to add the api"
    echo "secret generated by SurveyGizmo to your ~/.bashrc."
    echo "Please paste it below:"
    read surveysecret
    echo "export SURVEY_SECRET='$surveysecret'" >> ~/.bashrc
  else
    echo "SURVEY_SECRET is set!"
fi
echo "==============================================="
if [ -z ${SURVEY_CAMPAIGN+x} ]
  then
    echo "The survey created in SurveyGizmo is assigned a unique"
    echo "campaign number. Go ahead and add it to your ~/.bashrc."
    echo "By pasting it below:"
    read surveycampaign
    echo "export SURVEY_CAMPAIGN='$surveycampaign'" >> ~/.bashrc
  else
    echo "SURVEY_CAMPAIGN = $SURVEY_CAMPAIGN"
fi
echo "==============================================="
if [ -z ${APPT_URL+x} ]
  then
    echo "If you will offer 1:1 appointments with your students,"
    echo "you will need to add the booking URL to your ~/.bashrc"
    echo "by pasting it below:"
    read appturl
    echo "export APPT_URL='$appturl'" >> ~/.bashrc
  else
    echo "APPT_URL = $APPT_URL"
fi
echo "==============================================="
echo "ATTENTION: You must restart your open terminal sessions"
echo "for changes to take effect."
